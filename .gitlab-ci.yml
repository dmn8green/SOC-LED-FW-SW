stages:
  - build
  - utest

build:
  stage: build

  image: espressif/idf:release-v5.0

  variables:
    GIT_SUBMODULE_STRATEGY: recursive

  before_script:
    - apt-get update
    - apt-get install -yq cmake

  script:
    - idf.py build

utest:
  stage: utest

  image: gitlab.appliedlogix.com:4567/mn8-energy/light-controller-firmware

  variables:
    GIT_SUBMODULE_STRATEGY: recursive

  script:
    - echo $(pwd)
    - cd main/gtest
    - cmake .
    - cmake --build .
    - ./led-test

